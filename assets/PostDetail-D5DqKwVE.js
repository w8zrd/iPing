import{d as v,r as m,s as r,j as e,l as i}from"./index-4hGjUGNn.js";const y=()=>{const{id:l}=v(),[t,w]=m.useState(null),[h,p]=m.useState([]),[u,x]=m.useState(""),[N,c]=m.useState(!0),[g,a]=m.useState(null);m.useEffect(()=>{(async()=>{if(c(!0),a(null),!l){a("Post ID is missing."),c(!1);return}const{data:o,error:n}=await r.from("pings").select("*, profiles(username)").eq("id",l).single();if(n){i.error("Error fetching post",n,{userMessage:"Failed to fetch post."}),a("Failed to fetch post."),c(!1);return}const{count:f}=await r.from("likes").select("*",{count:"exact"}).eq("post_id",o.id),{data:b,error:j}=await r.from("comments").select("*, profiles(username)").eq("post_id",l).order("created_at",{ascending:!1});if(j){i.error("Error fetching comments",j,{userMessage:"Failed to fetch comments."}),a("Failed to fetch comments."),c(!1);return}w({...o,likes:f||0,comments:b.length}),p(b),c(!1)})();const d=r.channel("public:comments").on("postgres_changes",{event:"INSERT",schema:"public",table:"comments",filter:`post_id=eq.${l}`},o=>{const n=o.new;p(f=>[n,...f])}).subscribe();return()=>{r.removeChannel(d)}},[l]);const C=async s=>{if(s.preventDefault(),!u.trim())return;const d=await r.auth.getUser();if(!d.data.user){alert("You must be logged in to comment.");return}if(!t){a("Cannot add comment: Post not loaded.");return}const{data:o,error:n}=await r.from("comments").insert([{post_id:t.id,user_id:d.data.user.id,content:u}]);n?(i.error("Error adding comment",n,{userMessage:"Failed to add comment."}),a("Failed to add comment.")):(i.info("Comment added",{data:o}),x(""))};return N?e.jsx("p",{children:"Loading post details..."}):g?e.jsx("p",{className:"text-red-500",children:g}):t?e.jsxs("div",{className:"w-full max-w-2xl mx-auto p-4",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-4 mb-4",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("img",{src:"https://i.pravatar.cc/50",alt:"Avatar",className:"w-10 h-10 rounded-full mr-4"}),e.jsx("h3",{className:"font-bold",children:t.profiles?.username||"Unknown User"})]}),e.jsx("p",{className:"mb-4",children:t.content}),e.jsxs("div",{className:"flex justify-between text-gray-500",children:[e.jsxs("span",{children:[t.likes," Likes"]}),e.jsxs("span",{children:[t.comments," Comments"]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-4 mb-4",children:[e.jsx("h4",{className:"font-bold mb-2",children:"Comments"}),e.jsxs("form",{onSubmit:C,className:"mb-4",children:[e.jsx("textarea",{className:"w-full p-2 border rounded-md mb-2",rows:3,placeholder:"Add a comment...",value:u,onChange:s=>x(s.target.value)}),e.jsx("button",{type:"submit",className:"bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600",children:"Add Comment"})]}),h.length===0&&e.jsx("p",{children:"No comments yet. Be the first to comment!"}),h.map(s=>e.jsxs("div",{className:"border-t pt-2 mt-2",children:[e.jsx("p",{className:"text-sm font-bold",children:s.profiles?.username||"Unknown User"}),e.jsx("p",{className:"text-sm",children:s.content}),e.jsx("span",{className:"text-xs text-gray-400",children:new Date(s.created_at).toLocaleString()})]},s.id))]})]}):e.jsx("p",{children:"Post not found."})};export{y as default};
