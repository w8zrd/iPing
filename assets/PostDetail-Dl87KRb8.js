import{d as E,r as l,s as a,j as e,l as i}from"./index-Wo41H5bh.js";const P=()=>{var b;const{id:c}=E(),[t,N]=l.useState(null),[h,p]=l.useState([]),[u,x]=l.useState(""),[C,d]=l.useState(!0),[g,o]=l.useState(null);l.useEffect(()=>{(async()=>{if(d(!0),o(null),!c){o("Post ID is missing."),d(!1);return}const{data:m,error:r}=await a.from("pings").select("*, profiles(username)").eq("id",c).single();if(r){i.error("Error fetching post",r,{userMessage:"Failed to fetch post."}),o("Failed to fetch post."),d(!1);return}const{count:f}=await a.from("likes").select("*",{count:"exact"}).eq("post_id",m.id),{data:j,error:w}=await a.from("comments").select("*, profiles(username)").eq("post_id",c).order("created_at",{ascending:!1});if(w){i.error("Error fetching comments",w,{userMessage:"Failed to fetch comments."}),o("Failed to fetch comments."),d(!1);return}N({...m,likes:f||0,comments:j.length}),p(j),d(!1)})();const n=a.channel("public:comments").on("postgres_changes",{event:"INSERT",schema:"public",table:"comments",filter:`post_id=eq.${c}`},m=>{const r=m.new;p(f=>[r,...f])}).subscribe();return()=>{a.removeChannel(n)}},[c]);const v=async s=>{if(s.preventDefault(),!u.trim())return;const n=await a.auth.getUser();if(!n.data.user){alert("You must be logged in to comment.");return}if(!t){o("Cannot add comment: Post not loaded.");return}const{data:m,error:r}=await a.from("comments").insert([{post_id:t.id,user_id:n.data.user.id,content:u}]);r?(i.error("Error adding comment",r,{userMessage:"Failed to add comment."}),o("Failed to add comment.")):(i.info("Comment added",{data:m}),x(""))};return C?e.jsx("p",{children:"Loading post details..."}):g?e.jsx("p",{className:"text-red-500",children:g}):t?e.jsxs("div",{className:"w-full max-w-2xl mx-auto p-4",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-4 mb-4",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("img",{src:"https://i.pravatar.cc/50",alt:"Avatar",className:"w-10 h-10 rounded-full mr-4"}),e.jsx("h3",{className:"font-bold",children:((b=t.profiles)==null?void 0:b.username)||"Unknown User"})]}),e.jsx("p",{className:"mb-4",children:t.content}),e.jsxs("div",{className:"flex justify-between text-gray-500",children:[e.jsxs("span",{children:[t.likes," Likes"]}),e.jsxs("span",{children:[t.comments," Comments"]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-4 mb-4",children:[e.jsx("h4",{className:"font-bold mb-2",children:"Comments"}),e.jsxs("form",{onSubmit:v,className:"mb-4",children:[e.jsx("textarea",{className:"w-full p-2 border rounded-md mb-2",rows:3,placeholder:"Add a comment...",value:u,onChange:s=>x(s.target.value)}),e.jsx("button",{type:"submit",className:"bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600",children:"Add Comment"})]}),h.length===0&&e.jsx("p",{children:"No comments yet. Be the first to comment!"}),h.map(s=>{var n;return e.jsxs("div",{className:"border-t pt-2 mt-2",children:[e.jsx("p",{className:"text-sm font-bold",children:((n=s.profiles)==null?void 0:n.username)||"Unknown User"}),e.jsx("p",{className:"text-sm",children:s.content}),e.jsx("span",{className:"text-xs text-gray-400",children:new Date(s.created_at).toLocaleString()})]},s.id)})]})]}):e.jsx("p",{children:"Post not found."})};export{P as default};
