import{u as _,e as q,r as x,j as s,l as F}from"./index-B988mT6b.js";import{N as E,M as w}from"./Navigation-C_mdfttj.js";import{H as R}from"./Header-rqexykfP.js";import{u as U}from"./use-toast-BhhiqXJo.js";import{C as A}from"./x-BJs0uyLL.js";import{U as D}from"./user-plus-LS4DgQCx.js";import{H}from"./heart-Cm-DqPFs.js";import"./createLucideIcon-C40F9rup.js";const B=()=>{const p=_(),{notifications:l,loadingNotifications:o,markNotificationAsRead:c,fetchNotifications:i}=q(),{toast:v}=U(),[g,k]=x.useState({});x.useEffect(()=>{i()},[i]),x.useEffect(()=>{!o&&l.length>0&&l.filter(e=>!e.is_read).forEach(e=>{c(e.id)})},[l,o,c]);const $=e=>{switch(e){case"like":return s.jsx(H,{className:"h-5 w-5 text-red-500 fill-red-500"});case"follow":return s.jsx(D,{className:"h-5 w-5 text-primary"});case"comment":return s.jsx(w,{className:"h-5 w-5 text-blue-500"});case"mention":return s.jsx(w,{className:"h-5 w-5 text-purple-500"});default:return null}},C=e=>{var r,t,d,a,n;F.debug("Notification clicked",{notificationId:e.id,type:e.type}),c(e.id),e.type==="like"&&((r=e.pings)!=null&&r.id)?p(`/post/${e.pings.id}`):e.type==="comment"&&((t=e.pings)!=null&&t.id)?p(`/post/${e.pings.id}?openComments=true`):e.type==="follow"&&((d=e.sender)!=null&&d.username)?p(`/profile/${e.sender.username}`):e.type==="mention"&&((a=e.pings)!=null&&a.id)&&p(`/post/${e.pings.id}?highlightComment=${(n=e.comments)==null?void 0:n.id}`)},h=(e,r,t)=>{k(d=>({...d,[e]:r})),c(e),v({title:r==="accepted"?"Friend request accepted":"Friend request declined",description:`@${t} will be notified about your response`})};return s.jsxs("div",{className:"min-h-screen pb-32",children:[s.jsx(R,{}),s.jsxs("div",{className:"max-w-2xl mx-auto p-4",children:[s.jsx("div",{className:"mb-8 pt-32 animate-fade-in",children:s.jsx("h1",{className:"text-3xl font-bold",children:"Notifications"})}),o?s.jsx("div",{className:"flex items-center justify-center h-48",children:s.jsx("p",{className:"text-muted-foreground",children:"Loading notifications..."})}):l.length===0?s.jsx("div",{className:"flex items-center justify-center h-48",children:s.jsx("p",{className:"text-muted-foreground",children:"No notifications yet."})}):s.jsx("div",{className:"glass-strong rounded-3xl shadow-md overflow-hidden",children:l.map((e,r)=>{var t,d,a,n,N,y,j,b,f;return s.jsx("div",{className:`p-4 animate-fade-in border-b border-border/30 last:border-b-0 ${e.is_read?"":"bg-primary/5"} ${e.type==="friend_request"?"":"cursor-pointer hover:bg-primary/5 transition-apple"}`,style:{animationDelay:`${r*.05}s`},onClick:()=>e.type!=="friend_request"&&C(e),children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsxs("div",{className:"relative",children:[s.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-primary via-primary/80 to-primary/50 text-white font-bold flex items-center justify-center",children:(t=e.sender)!=null&&t.display_name?(d=e.sender.display_name)==null?void 0:d.toUpperCase():"?"}),s.jsx("div",{className:"absolute -bottom-1 -right-1 bg-background rounded-full p-0.5",children:$(e.type)})]}),s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx("span",{className:"font-semibold",children:((a=e.sender)==null?void 0:a.display_name)||"Unknown User"}),((n=e.sender)==null?void 0:n.verified)&&s.jsx("div",{className:"flex items-center justify-center w-4 h-4 bg-primary rounded-full",children:s.jsx(A,{className:"h-3 w-3 text-white stroke-"})}),s.jsxs("span",{className:"text-muted-foreground text-sm",children:["@",((N=e.sender)==null?void 0:N.username)||"unknown"]})]}),e.type==="friend_request"&&g[e.id]?s.jsxs(s.Fragment,{children:[s.jsxs("p",{className:"text-sm text-foreground/80",children:["You ",g[e.id]," @",((y=e.sender)==null?void 0:y.username)||"unknown","'s friend request"]}),s.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:new Date(e.created_at).toLocaleString()})]}):s.jsxs(s.Fragment,{children:[s.jsx("p",{className:"text-sm text-foreground/80",children:e.type==="like"&&((j=e.pings)!=null&&j.content)?`liked your ping: "${e.pings.content}"`:e.type==="comment"&&((b=e.comments)!=null&&b.content)?`commented on your ping: "${e.comments.content}"`:e.type==="follow"?"started following you":e.type==="mention"&&((f=e.pings)!=null&&f.content)?`mentioned you in a ping: "${e.pings.content}"`:`New ${e.type} notification`}),s.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:new Date(e.created_at).toLocaleString()}),e.type==="friend_request"&&s.jsxs("div",{className:"flex gap-2 mt-3",children:[s.jsx("button",{onClick:u=>{var m;u.stopPropagation(),h(e.id,"accepted",((m=e.sender)==null?void 0:m.username)||"unknown")},className:"h-8 px-4 py-2 text-sm font-medium rounded-full bg-primary text-primary-foreground hover:bg-primary/90",children:"Accept"}),s.jsx("button",{onClick:u=>{var m;u.stopPropagation(),h(e.id,"rejected",((m=e.sender)==null?void 0:m.username)||"unknown")},className:"h-8 px-4 py-2 text-sm font-medium rounded-full border border-border/50 bg-background/50 hover:bg-background/80",children:"Decline"})]})]})]})]})},e.id)})})]}),s.jsx(E,{})]})};export{B as default};
