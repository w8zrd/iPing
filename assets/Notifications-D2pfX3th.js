import{o as q,E as A,s as F,r as u,j as s,w as E}from"./index-DducP8rb.js";import{N as R,M as b}from"./Navigation-P7o5lEdf.js";import{H as U}from"./Header-CQ7TAL7X.js";import{A as D,a as H}from"./avatar-Bh045AcM.js";import{B as v}from"./button-Bam1vjCP.js";import{C as L}from"./check-Bbp2UOjP.js";import{U as P}from"./user-plus-C1b9krKP.js";import{H as S}from"./heart-BAVNW55s.js";import"./input-Ce_VQZZ0.js";import"./index-DhRncdj7.js";const Q=()=>{const c=q(),{notifications:d,loadingNotifications:o,markNotificationAsRead:p,fetchNotifications:x}=A(),{toast:k}=F(),[h,$]=u.useState({});u.useEffect(()=>{x()},[x]),u.useEffect(()=>{!o&&d.length>0&&d.filter(e=>!e.is_read).forEach(e=>{p(e.id)})},[d,o,p]);const C=e=>{switch(e){case"like":return s.jsx(S,{className:"h-5 w-5 text-red-500 fill-red-500"});case"follow":return s.jsx(P,{className:"h-5 w-5 text-primary"});case"comment":return s.jsx(b,{className:"h-5 w-5 text-blue-500"});case"mention":return s.jsx(b,{className:"h-5 w-5 text-purple-500"});default:return null}},_=e=>{var r,t,a,l,n;E.debug("Notification clicked",{notificationId:e.id,type:e.type}),p(e.id),e.type==="like"&&((r=e.pings)!=null&&r.id)?c(`/post/${e.pings.id}`):e.type==="comment"&&((t=e.pings)!=null&&t.id)?c(`/post/${e.pings.id}?openComments=true`):e.type==="follow"&&((a=e.sender)!=null&&a.username)?c(`/profile/${e.sender.username}`):e.type==="mention"&&((l=e.pings)!=null&&l.id)&&c(`/post/${e.pings.id}?highlightComment=${(n=e.comments)==null?void 0:n.id}`)},g=(e,r,t)=>{$(a=>({...a,[e]:r})),p(e),k({title:r==="accepted"?"Friend request accepted":"Friend request declined",description:`@${t} will be notified about your response`})};return s.jsxs("div",{className:"min-h-screen pb-32",children:[s.jsx(U,{}),s.jsxs("div",{className:"max-w-2xl mx-auto p-4",children:[s.jsx("div",{className:"mb-8 pt-32 animate-fade-in",children:s.jsx("h1",{className:"text-3xl font-bold",children:"Notifications"})}),o?s.jsx("div",{className:"flex items-center justify-center h-48",children:s.jsx("p",{className:"text-muted-foreground",children:"Loading notifications..."})}):d.length===0?s.jsx("div",{className:"flex items-center justify-center h-48",children:s.jsx("p",{className:"text-muted-foreground",children:"No notifications yet."})}):s.jsx("div",{className:"glass-strong rounded-3xl shadow-md overflow-hidden",children:d.map((e,r)=>{var t,a,l,n,N,j,y,f,w;return s.jsx("div",{className:`p-4 animate-fade-in border-b border-border/30 last:border-b-0 ${e.is_read?"":"bg-primary/5"} ${e.type==="friend_request"?"":"cursor-pointer hover:bg-primary/5 transition-apple"}`,style:{animationDelay:`${r*.05}s`},onClick:()=>e.type!=="friend_request"&&_(e),children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsxs("div",{className:"relative",children:[s.jsx(D,{className:"w-12 h-12",children:s.jsx(H,{className:"bg-gradient-to-br from-primary via-primary/80 to-primary/50 text-white font-bold",children:(t=e.sender)!=null&&t.display_name?(a=e.sender.display_name)==null?void 0:a.toUpperCase():"?"})}),s.jsx("div",{className:"absolute -bottom-1 -right-1 bg-background rounded-full p-0.5",children:C(e.type)})]}),s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx("span",{className:"font-semibold",children:((l=e.sender)==null?void 0:l.display_name)||"Unknown User"}),((n=e.sender)==null?void 0:n.verified)&&s.jsx("div",{className:"flex items-center justify-center w-4 h-4 bg-primary rounded-full",children:s.jsx(L,{className:"h-3 w-3 text-white stroke-"})}),s.jsxs("span",{className:"text-muted-foreground text-sm",children:["@",((N=e.sender)==null?void 0:N.username)||"unknown"]})]}),e.type==="friend_request"&&h[e.id]?s.jsxs(s.Fragment,{children:[s.jsxs("p",{className:"text-sm text-foreground/80",children:["You ",h[e.id]," @",((j=e.sender)==null?void 0:j.username)||"unknown","'s friend request"]}),s.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:new Date(e.created_at).toLocaleString()})]}):s.jsxs(s.Fragment,{children:[s.jsx("p",{className:"text-sm text-foreground/80",children:e.type==="like"&&((y=e.pings)!=null&&y.content)?`liked your ping: "${e.pings.content}"`:e.type==="comment"&&((f=e.comments)!=null&&f.content)?`commented on your ping: "${e.comments.content}"`:e.type==="follow"?"started following you":e.type==="mention"&&((w=e.pings)!=null&&w.content)?`mentioned you in a ping: "${e.pings.content}"`:`New ${e.type} notification`}),s.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:new Date(e.created_at).toLocaleString()}),e.type==="friend_request"&&s.jsxs("div",{className:"flex gap-2 mt-3",children:[s.jsx(v,{size:"sm",onClick:i=>{var m;i.stopPropagation(),g(e.id,"accepted",((m=e.sender)==null?void 0:m.username)||"unknown")},children:"Accept"}),s.jsx(v,{size:"sm",variant:"outline",onClick:i=>{var m;i.stopPropagation(),g(e.id,"rejected",((m=e.sender)==null?void 0:m.username)||"unknown")},children:"Decline"})]})]})]})]})},e.id)})})]}),s.jsx(R,{})]})};export{Q as default};
