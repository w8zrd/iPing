import{r as s,j as e,u as T,c as U,s as _}from"./index-7NNGqfc9.js";import{N as R}from"./Navigation-TpTAvfuA.js";import{B as w}from"./Button-DBwwaDy9.js";import{L as z,I as x}from"./Input-CUvAQOMl.js";import{T as B}from"./Textarea-BZyFUAjc.js";import{c as f}from"./utils-Dtjc6EhN.js";import{X as O}from"./x-C38w8Qr-.js";import{A as F,b as H,a as q}from"./Avatar-CdRLTdzX.js";import{u as M}from"./use-toast-BZ8SEqu7.js";import{a as V}from"./user-CGAzZXAD.js";import{A as X}from"./arrow-left-DdIB7tSE.js";import{c as Y}from"./createLucideIcon-C7qtLkCo.js";const $=Y("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]),g=s.createContext({open:!1,setOpen:()=>{}}),G=({children:t})=>{const[r,o]=s.useState(!1);return e.jsx(g.Provider,{value:{open:r,setOpen:o},children:t})},k=s.forwardRef(({asChild:t,className:r,...o},n)=>{const{setOpen:l}=s.useContext(g),i=t?"span":"button";return e.jsx(i,{ref:n,className:f("cursor-pointer",r),onClick:()=>l(!0),...o})});k.displayName="DialogTrigger";const S=s.forwardRef(({className:t,children:r,...o},n)=>{const{open:l,setOpen:i}=s.useContext(g);return l?e.jsx("div",{className:"fixed inset-0 z-50 overflow-hidden",onClick:()=>i(!1),children:e.jsxs("div",{ref:n,className:f("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 sm:rounded-lg",t),onClick:c=>c.stopPropagation(),...o,children:[r,e.jsxs("button",{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none",onClick:()=>i(!1),children:[e.jsx(O,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})}):null});S.displayName="DialogContent";const D=({className:t,...r})=>e.jsx("div",{className:f("flex flex-col space-y-1.5 text-center sm:text-left",t),...r});D.displayName="DialogHeader";const P=s.forwardRef(({className:t,...r},o)=>e.jsx("h2",{ref:o,className:f("text-lg font-semibold leading-none tracking-tight",t),...r}));P.displayName="DialogTitle";const le=()=>{const t=T(),{user:r}=U(),[o,n]=s.useState(null),[l,i]=s.useState(""),[c,h]=s.useState(""),[b,v]=s.useState(""),[y,j]=s.useState(""),[E,N]=s.useState(""),[C,u]=s.useState(!1),{toast:d}=M();s.useEffect(()=>{L()},[r]);const L=async()=>{if(!r)return;u(!0);const{data:a,error:m}=await _.from("profiles").select("username, display_name, bio, verified, location, avatar_url").eq("id",r.id).single();if(!m&&a){const p={...a,display_name:a.display_name};n(p),i(a.bio||""),h(a.display_name||""),v(a.username||""),j(a.location||""),N(a.avatar_url||"")}else console.error("Error fetching profile for settings:",m),d({title:"Error",description:"Could not load profile data.",variant:"destructive"});u(!1)},A=a=>{const m=a.target.files?.[0];if(m){const p=new FileReader;p.onloadend=()=>{N(p.result),d({title:"Profile picture updated (Placeholder)",description:"Image logic needs actual Supabase storage implementation."})},p.readAsDataURL(m)}},I=async()=>{if(!r||C){d({title:"Error",description:"User not authenticated or loading",variant:"destructive"});return}u(!0);try{await V({username:b,display_name:c,bio:l,location:y}),d({title:"Settings Updated",description:"Your changes have been saved to the database.",variant:"success"})}catch(a){console.error("Save error:",a),d({title:"Error",description:`Failed to save changes: ${a.message}`,variant:"destructive"})}finally{u(!1)}};return C||!o?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx(z,{className:"h-8 w-8 animate-spin text-primary"})}):e.jsxs("div",{className:"min-h-screen pb-32",children:[e.jsxs("div",{className:"max-w-2xl mx-auto p-4",children:[e.jsxs("div",{className:"mb-8 pt-8 animate-fade-in flex items-center gap-4",children:[e.jsx(w,{variant:"ghost",size:"icon",onClick:()=>t(-1),className:"rounded-full",children:e.jsx(X,{className:"h-5 w-5"})}),e.jsx("h1",{className:"text-3xl font-bold",children:"Settings"})]}),e.jsx("div",{className:"glass-strong rounded-3xl p-8 mb-6 shadow-lg animate-scale-in",children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex flex-col items-center mb-6",children:e.jsxs(G,{children:[e.jsx(k,{asChild:!0,children:e.jsxs("div",{className:"relative cursor-pointer group",children:[e.jsxs(F,{className:"w-24 h-24 ring-4 ring-primary/20 shadow-lg",children:[e.jsx(H,{src:E}),e.jsx(q,{className:"bg-gradient-to-br from-primary via-primary/80 to-primary/50 text-white text-3xl font-bold",children:c?.toUpperCase()||"U"})]}),e.jsx("div",{className:"absolute inset-0 rounded-full bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center",children:e.jsx($,{className:"h-6 w-6 text-white"})})]})}),e.jsxs(S,{className:"sm:max-w-md",children:[e.jsx(D,{children:e.jsx(P,{children:"Change Profile Picture"})}),e.jsx("div",{className:"flex flex-col gap-4 py-4",children:e.jsx("input",{type:"file",accept:"image/*",onChange:A,className:"file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-primary file:text-primary-foreground hover:file:bg-primary/90 file:cursor-pointer"})})]})]})}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Username"}),e.jsx(x,{value:b,onChange:a=>v(a.target.value),placeholder:"Enter your username",className:"h-12 rounded-2xl glass border-border/50 focus:border-primary transition-apple"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Display Name"}),e.jsx(x,{value:c,onChange:a=>h(a.target.value),placeholder:"Enter your display name",className:"h-12 rounded-2xl glass border-border/50 focus:border-primary transition-apple"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Bio"}),e.jsx(B,{value:l,onChange:a=>i(a.target.value),placeholder:"Tell us about yourself",className:"min-h-[100px] rounded-2xl glass border-border/50 resize-none focus:border-primary transition-apple"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Location"}),e.jsx(x,{value:y,onChange:a=>j(a.target.value),placeholder:"Enter your location",className:"h-12 rounded-2xl glass border-border/50 focus:border-primary transition-apple"})]}),e.jsx(w,{onClick:I,className:"w-full h-12 rounded-2xl bg-primary hover:bg-primary/90 font-semibold transition-apple",children:"Save Changes"})]})})]}),e.jsx(R,{})]})};export{le as default};
