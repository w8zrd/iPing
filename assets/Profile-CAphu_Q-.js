import{d as L,u as S,c as D,l as o,r as w,j as e,L as U,s as m}from"./index-B988mT6b.js";import{N as $}from"./Navigation-C_mdfttj.js";import{H as q,S as I}from"./Header-rqexykfP.js";import{u as T}from"./use-toast-BhhiqXJo.js";import A from"./NotFound-Vgh2Yorf.js";import{P as k}from"./textParser-FWV9AtS2.js";import{A as Y}from"./arrow-left-w9cjPnmt.js";import{C as F}from"./x-BJs0uyLL.js";import{U as O}from"./user-plus-LS4DgQCx.js";import{c as E}from"./createLucideIcon-C40F9rup.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=E("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R=E("MapPin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]),z={id:"0",username:"error",display_name:"Error Loading User",bio:"Profile data could not be fetched.",verified:!1,location:null,created_at:new Date().toISOString(),posts:[]},se=()=>{var j;const{username:f}=L(),d=S(),{user:s,loading:u}=D();o.debug("Profile component mounted",{urlUsername:f});const[a,c]=w.useState(null),[x,n]=w.useState(!0),{toast:h}=T(),g=(s==null?void 0:s.user_metadata.username)===f;if(w.useEffect(()=>{var b;if(o.debug("Profile useEffect triggered."),u)return;const t=f||((b=s==null?void 0:s.user_metadata)==null?void 0:b.username);o.debug("Profile.tsx: targetUsername derived",{targetUsername:t});const l=async p=>{n(!0),o.debug("Profile.tsx: Attempting to fetch profile",{targetUser:p}),o.debug("Profile.tsx: Fetching profile data",{targetUser:p});const{data:i,error:N}=await m.from("profiles").select("id, username, display_name, bio, verified, location, created_at").eq("username",p).single();if(N){o.error("Profile.tsx: Error fetching profile",N,{userMessage:"Failed to load profile."}),c(null),n(!1);return}if(!i){o.warn("Profile.tsx: No profile data found",{targetUser:p},{userMessage:"Profile not found."}),c(null),n(!1);return}o.debug("Profile.tsx: Successfully fetched profileData",{profileData:i}),o.debug("Profile.tsx: Fetching posts for user ID",{userId:i.id});const{data:v,error:y}=await m.from("pings").select("id, content, created_at").eq("user_id",i.id).order("created_at",{ascending:!1});y&&o.error("Profile.tsx: Error fetching posts",y,{userMessage:"Failed to load posts."}),o.debug("Profile.tsx: Posts fetched",{postsData:v});let _=!1;if(s&&s.id!==i.id){o.debug("Profile.tsx: Checking follow status",{followerId:s.id,followingId:i.id});const{count:C,error:P}=await m.from("follows").select("*",{count:"exact"}).eq("follower_id",s.id).eq("following_id",i.id);P?o.error("Profile.tsx: Error checking follow status",P):_=C>0}c({...i,posts:v||[],is_following:_}),n(!1),o.debug("Profile.tsx: setUserProfile completed.")};t?l(t):s&&s.user_metadata.username?l(s.user_metadata.username):(c(null),n(!1))},[f,u,s,d]),x||u)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx(U,{})});const r=a||z;if(!a&&!x&&!u)return e.jsx(A,{});const M=async()=>{if(!s){d("/auth");return}if(s.id===r.id){h({title:"Error",description:"You cannot follow yourself.",variant:"destructive"});return}if(n(!0),a!=null&&a.is_following){const{error:t}=await m.from("follows").delete().eq("follower_id",s.id).eq("following_id",r.id);t?o.error("Profile.tsx: Error unfollowing",t,{userMessage:`Failed to unfollow: ${t.message}`,showToast:!0}):(c(l=>l?{...l,is_following:!1}:null),h({title:"Unfollowed!",description:`You are no longer following ${r.display_name}.`}))}else{const{error:t}=await m.from("follows").insert([{follower_id:s.id,following_id:r.id}]);t?o.error("Profile.tsx: Error following",t,{userMessage:`Failed to follow: ${t.message}`,showToast:!0}):(c(l=>l?{...l,is_following:!0}:null),h({title:"Followed!",description:`You are now following ${r.display_name}.`}))}n(!1)};return e.jsxs("div",{className:"min-h-screen pb-32",children:[e.jsx(q,{}),e.jsxs("div",{className:"max-w-2xl mx-auto p-4",children:[e.jsxs("div",{className:"mb-8 pt-24 animate-fade-in flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[!g&&e.jsx("button",{onClick:()=>d(-1),className:"p-2 rounded-full transition-colors text-muted-foreground hover:bg-background/80",children:e.jsx(Y,{className:"h-5 w-5"})}),e.jsx("h1",{className:"text-3xl font-bold",children:"Profile"})]}),g&&e.jsx("button",{onClick:()=>d("/settings"),className:"p-2 rounded-full transition-colors text-muted-foreground hover:text-foreground active:text-primary",children:e.jsx(I,{className:"h-6 w-6"})})]}),e.jsxs("div",{className:"glass-strong rounded-3xl p-6 mb-6 shadow-lg animate-scale-in",children:[e.jsxs("div",{className:"flex items-start gap-4 mb-4",children:[e.jsx("div",{className:"relative",children:e.jsx("div",{className:"w-20 h-20 rounded-full bg-gradient-to-br from-primary via-primary/80 to-primary/50 text-white text-2xl font-bold flex items-center justify-center ring-4 ring-primary/20 shadow-lg",children:((j=r.display_name[0])==null?void 0:j.toUpperCase())||"U"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-1",children:[e.jsx("h2",{className:"text-xl font-bold",children:r.display_name}),r.verified&&e.jsx("div",{className:"flex items-center justify-center w-5 h-5 bg-primary rounded-full",children:e.jsx(F,{className:"h-3.5 w-3.5 text-white stroke-[3]"})})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["@",r.username]})]})]}),!g&&e.jsxs("div",{className:"flex gap-2 mb-4",children:[e.jsx("button",{onClick:M,disabled:x,className:`flex-1 rounded-full hover:scale-105 transition-apple h-10 px-4 py-2 text-sm font-medium ${a!=null&&a.is_following?"border border-border/50 bg-background/50 hover:bg-background/80":"bg-primary text-primary-foreground hover:bg-primary/90"} disabled:opacity-50 disabled:cursor-not-allowed items-center justify-center`,children:x?"...":a!=null&&a.is_following?e.jsxs(e.Fragment,{children:[e.jsx(F,{className:"h-4 w-4 mr-2"})," Following"]}):e.jsxs(e.Fragment,{children:[e.jsx(O,{className:"h-4 w-4 mr-2"})," Follow"]})}),e.jsx("button",{onClick:()=>{d(s?`/chats/${r.username}`:"/auth")},className:"flex-1 rounded-full hover:scale-105 transition-apple h-10 px-4 py-2 text-sm font-medium border border-border/50 bg-background/50 hover:bg-background/80",children:"Message"})]}),e.jsx("p",{className:"text-sm text-foreground/90 mb-4",children:e.jsx(k,{text:r.bio||"No bio provided."})}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground mb-4",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(H,{className:"h-4 w-4"}),e.jsxs("span",{children:["Joined ",new Date(r.created_at).toLocaleDateString("en-US",{year:"numeric",month:"long"})]})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(R,{className:"h-4 w-4"}),e.jsx("span",{children:r.location||"Unknown"})]})]}),e.jsxs("div",{className:"flex gap-6 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-bold text-foreground",children:r.posts.length}),e.jsx("span",{className:"text-muted-foreground ml-1",children:"Posts"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-bold text-foreground",children:"0"}),e.jsx("span",{className:"text-muted-foreground ml-1",children:"Following"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-bold text-foreground",children:"0"}),e.jsx("span",{className:"text-muted-foreground ml-1",children:"Followers"})]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-xl font-semibold mb-4",children:g?"Your Posts":`${r.display_name}'s Posts`}),e.jsx("div",{className:"space-y-4",children:r.posts.map((t,l)=>e.jsxs("div",{className:"glass rounded-3xl p-6 shadow-md animate-fade-in",style:{animationDelay:`${l*.05}s`},children:[e.jsx("p",{className:"text-foreground/90 mb-2",children:e.jsx(k,{text:t.content})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:new Date(t.created_at).toLocaleString()})]},t.id))})]})]}),e.jsx($,{})]})};export{se as default};
