import{d as E,u as M,r as l,c as R,f as A,j as e,l as x}from"./index-Wo41H5bh.js";import{P as T}from"./textParser-Otv_Pc-Z.js";import{A as z}from"./arrow-left-CX4fna4Q.js";import{C as S,X as P}from"./x-BqAOQNjw.js";import{c as $}from"./createLucideIcon-foOATjnS.js";import{I as q,S as F}from"./send-wXZ8iKWk.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=$("CheckCheck",[["path",{d:"M18 6 7 17l-5-5",key:"116fxf"}],["path",{d:"m22 10-7.5 7.5L13 16",key:"ke71qq"}]]),Q=()=>{var k,w;const{chatId:t}=E(),I=M(),[d,h]=l.useState(""),[f,p]=l.useState([]),[o,m]=l.useState(null),[r,D]=l.useState(null),{user:a}=R(),{markChatAsRead:u,fetchChatDetails:g,fetchChatMessages:b,sendMessage:L,subscribeToChatMessages:j}=A(),N=l.useRef(null),[O,v]=l.useState(!0);(k=r==null?void 0:r.chat_participants)==null||k.find(s=>s.user_id!==(a==null?void 0:a.id));const y=l.useCallback(()=>{if(!t||!a)return()=>{};v(!0);const s=g(t,i=>{D(i)}),n=b(t,i=>{p(i),u(t),v(!1)});return()=>{s(),n()}},[t,a,g,b,u]);l.useEffect(()=>{const s=y(),n=j(t,i=>{p(c=>[...c,i]),u(t)});return()=>{s(),n()}},[t,a,j,y]),l.useEffect(()=>{var s;(s=N.current)==null||s.scrollIntoView({behavior:"smooth"})},[f]);const _=s=>{var i;const n=(i=s.target.files)==null?void 0:i[0];if(n){const c=new FileReader;c.onloadend=()=>{m(c.result),x.debug("Image loaded for preview")},c.readAsDataURL(n)}},C=async()=>{if((d.trim()||o)&&t){x.debug("Sending message",{chatId:t,hasContent:!!d,hasImage:!!o});try{await L(t,d),h(""),m(null)}catch(s){x.error("Failed to send message",s)}}};return e.jsxs("div",{className:"min-h-screen flex flex-col",children:[e.jsx("header",{className:"fixed top-0 left-0 right-0 z-50 glass-strong border-b",children:e.jsxs("div",{className:"flex items-center gap-3 p-4",children:[e.jsx("button",{onClick:()=>I("/chats"),className:"p-2 rounded-full transition-colors text-muted-foreground hover:bg-background/80",children:e.jsx(z,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-primary via-primary/80 to-primary/50 text-white font-bold flex items-center justify-center",children:(w=r.user.displayName[0])==null?void 0:w.toUpperCase()}),(r.user.username==="alex"||r.user.username==="mike")&&e.jsx("div",{className:"absolute bottom-0 right-0 w-3 h-3 bg-green-500 rounded-full border-2 border-background"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"font-semibold",children:r.user.displayName}),r.user.verified&&e.jsx("div",{className:"flex items-center justify-center w-4 h-4 bg-primary rounded-full",children:e.jsx(S,{className:"h-3 w-3 text-white stroke-[3]"})})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsxs("span",{children:["@",r.user.username]}),e.jsx("span",{children:"â€¢"}),r.user.username==="alex"||r.user.username==="mike"?e.jsx("span",{className:"text-green-500 font-medium",children:"Online"}):e.jsx("span",{children:"Last seen 2h ago"})]})]})]})]})}),e.jsx("main",{className:"flex-1 pt-20 pb-32 px-4 max-w-2xl mx-auto w-full",children:e.jsxs("div",{className:"space-y-4",children:[f.map(s=>e.jsx("div",{className:`flex ${s.sender_id===(a==null?void 0:a.id)?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-[75%] rounded-2xl px-4 py-2 ${s.sender_id===(a==null?void 0:a.id)?"bg-primary text-primary-foreground":"glass-strong"}`,children:[s.content&&e.jsx("p",{className:"text-sm",children:e.jsx(T,{text:s.content})}),e.jsxs("div",{className:"flex items-center gap-1.5 mt-1",children:[e.jsx("p",{className:"text-xs opacity-70",children:new Date(s.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),s.sender_id===(a==null?void 0:a.id)&&e.jsx("span",{className:`${s.is_read?"text-green-400":"text-primary-foreground"}`,children:s.is_read?e.jsx(K,{className:"h-3 w-3"}):e.jsx(S,{className:"h-3 w-3"})})]})]})},s.id)),e.jsx("div",{ref:N})]})}),e.jsx("footer",{className:"fixed bottom-0 left-0 right-0 z-50 pb-safe",children:e.jsxs("div",{className:"glass-strong border-t mx-4 mb-4 rounded-3xl p-4",children:[o&&e.jsxs("div",{className:"relative mb-3",children:[e.jsx("img",{src:o,alt:"Upload preview",className:"rounded-2xl max-h-40 w-auto"}),e.jsx("button",{onClick:()=>m(null),className:"absolute top-2 right-2 bg-background/80 backdrop-blur-sm rounded-full p-1.5 hover:bg-background transition-apple",children:e.jsx(P,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsxs("label",{className:"shrink-0",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:_,className:"hidden"}),e.jsx("button",{type:"button",className:"rounded-full h-11 w-11 border border-border/50 bg-background/50 hover:bg-background/80 transition-apple flex items-center justify-center",onClick:s=>{var n;s.preventDefault(),(n=s.currentTarget.previousElementSibling)==null||n.click()},children:e.jsx(q,{className:"h-5 w-5"})})]}),e.jsx("textarea",{value:d,onChange:s=>h(s.target.value),placeholder:"Type a message...",className:"flex-1 min-h-[44px] max-h-32 resize-none rounded-2xl p-2 bg-transparent focus:outline-none border border-border/50",onKeyDown:s=>{s.key==="Enter"&&!s.shiftKey&&(s.preventDefault(),C())}}),e.jsx("button",{onClick:C,className:"rounded-full h-11 w-11 shrink-0 bg-primary text-primary-foreground hover:bg-primary/90 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center",disabled:!d.trim()&&!o,children:e.jsx(F,{className:"h-5 w-5"})})]})]})})]})};export{Q as default};
