import{d as $,u as A,c as D,r as o,s as i,j as e,S as t}from"./index-CmjTYx1p.js";import{N as y,M as L}from"./Navigation-CHjydaJ2.js";import{H as b,S as T}from"./Header-YnqcYYPA.js";import{B as g}from"./Button-CDn2SHYY.js";import{A as H,a as Y}from"./Avatar-D7vqHW8B.js";import{u as z}from"./use-toast-BZ8SEqu7.js";import{P as k}from"./textParser-D5nydWJE.js";import{i as B,u as I,f as O}from"./user-DUPhjnqr.js";import{A as J}from"./arrow-left-S9X7E55r.js";import{C as R}from"./check-B4vFeBbu.js";import{c as j}from"./createLucideIcon-CKR8FJiQ.js";import{U as G}from"./user-plus-1hQefAXV.js";import"./x-p25QsYo7.js";const K=j("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);const Q=j("MapPin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);const V=j("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]),de=()=>{const{username:x}=$(),f=A(),{user:r}=D(),[a,w]=o.useState(null),[h,C]=o.useState([]),[F,u]=o.useState(0),[P,_]=o.useState(0),[c,p]=o.useState(!1),{toast:d}=z();o.useEffect(()=>{window.scrollTo(0,0),x?U(x):r&&S()},[x,r]),o.useEffect(()=>{r&&a&&r.id!==a.id&&M(a.id)},[a,r]);const U=async s=>{const{data:l,error:n}=await i.from("profiles").select("*").eq("username",s).single();!n&&l&&(w(l),N(l.id),v(l.id))},S=async()=>{if(!r)return;const{data:s,error:l}=await i.from("profiles").select("*").eq("id",r.id).single();!l&&s&&(w(s),N(s.id),v(s.id))},N=async s=>{const{data:l,error:n}=await i.from("pings").select("*").eq("user_id",s).order("created_at",{ascending:!1});!n&&l&&C(l)},v=async s=>{const{count:l}=await i.from("follows").select("*",{count:"exact",head:!0}).eq("followed_id",s),{count:n}=await i.from("follows").select("*",{count:"exact",head:!0}).eq("follower_id",s);u(l||0),_(n||0)},M=async s=>{try{const l=await B(s);p(l)}catch(l){console.error("Error fetching following status:",l),d({title:"Error",description:"Could not fetch following status.",variant:"destructive"})}},q=async()=>{if(!(!r||!a))try{c?(await I(a.id),p(!1),u(s=>s-1),d({title:"Unfollowed!",description:`You are no longer following ${a.display_name}`})):(await O(a.id),p(!0),u(s=>s+1),d({title:"Followed!",description:`You are now following ${a.display_name}`,variant:"success"}))}catch(s){console.error("Follow/Unfollow error:",s),d({title:"Error",description:`Could not ${c?"unfollow":"follow"} ${a.display_name}.`,variant:"destructive"})}},E=async()=>{if(!r||!a)return;const{data:s,error:l}=await i.rpc("create_direct_chat",{other_user:a.id});!l&&s&&f(`/chats/${s}`)},m=r?.id===a?.id;return a?e.jsxs("div",{className:"min-h-screen pb-20 bg-background",children:[e.jsx(b,{}),e.jsxs("div",{className:"max-w-2xl mx-auto p-4",children:[e.jsxs("div",{className:"mb-8 pt-24 animate-fade-in flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[!m&&e.jsx(g,{variant:"ghost",size:"icon",onClick:()=>f(-1),className:"rounded-full",children:e.jsx(J,{className:"h-5 w-5"})}),e.jsx("h1",{className:"text-3xl font-bold",children:"Profile"})]}),m&&e.jsx("button",{onClick:()=>f("/settings"),className:"p-2 rounded-full transition-colors text-muted-foreground hover:text-foreground active:text-primary",children:e.jsx(T,{className:"h-6 w-6"})})]}),e.jsxs("div",{className:"glass-strong rounded-3xl p-6 mb-6 shadow-lg animate-scale-in",children:[e.jsxs("div",{className:"flex items-start gap-4 mb-4",children:[e.jsx(H,{className:"w-20 h-20 ring-4 ring-primary/20 shadow-lg",children:e.jsx(Y,{className:"bg-gradient-to-br from-primary via-primary/80 to-primary/50 text-white text-2xl font-bold",children:a.display_name[0]?.toUpperCase()||"U"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-1",children:[e.jsx("h2",{className:"text-xl font-bold",children:a.display_name}),a.verified&&e.jsx("div",{className:"flex items-center justify-center w-5 h-5 bg-primary rounded-full",children:e.jsx(R,{className:"h-3.5 w-3.5 text-white stroke-[3]"})})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["@",a.username]})]})]}),!m&&e.jsxs("div",{className:"flex gap-2 mb-4",children:[e.jsx(g,{onClick:q,variant:c?"outline":"default",className:"flex-1 rounded-full hover:scale-105 transition-apple",children:c?e.jsxs(e.Fragment,{children:[e.jsx(V,{className:"h-4 w-4 mr-2"}),"Following"]}):e.jsxs(e.Fragment,{children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),"Follow"]})}),e.jsxs(g,{onClick:E,variant:"outline",className:"flex-1 rounded-full hover:scale-105 transition-apple",children:[e.jsx(L,{className:"h-4 w-4 mr-2"}),"Message"]})]}),a.bio&&e.jsx("p",{className:"text-sm text-foreground/90 mb-4",children:e.jsx(k,{text:a.bio})}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground mb-4",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(K,{className:"h-4 w-4"}),e.jsxs("span",{children:["Joined ",new Date(a.created_at).toLocaleDateString("en-US",{month:"long",year:"numeric"})]})]}),a.location&&e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(Q,{className:"h-4 w-4"}),e.jsx("span",{children:a.location})]})]}),e.jsxs("div",{className:"flex gap-6 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-bold text-foreground",children:h.length}),e.jsx("span",{className:"text-muted-foreground ml-1",children:"Pings"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-bold text-foreground",children:P}),e.jsx("span",{className:"text-muted-foreground ml-1",children:"Following"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-bold text-foreground",children:F}),e.jsx("span",{className:"text-muted-foreground ml-1",children:"Followers"})]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-xl font-semibold mb-4",children:m?"Your Pings":`${a.display_name}'s Pings`}),e.jsx("div",{className:"space-y-4",children:h.length===0?e.jsx("div",{className:"glass rounded-3xl p-8 text-center",children:e.jsx("p",{className:"text-muted-foreground",children:"No pings yet"})}):h.map((s,l)=>e.jsxs("div",{className:"glass rounded-3xl p-6 shadow-md animate-fade-in",style:{animationDelay:`${l*.05}s`},children:[e.jsx("p",{className:"text-foreground/90 mb-2",children:e.jsx(k,{text:s.content})}),s.image_url&&e.jsx("img",{src:s.image_url,alt:"Post",className:"rounded-2xl w-full mb-2 max-h-96 object-cover"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:new Date(s.created_at).toLocaleString()})]},s.id))})]})]}),e.jsx(y,{})]}):e.jsxs("div",{className:"min-h-screen pb-20 bg-background",children:[e.jsx(b,{}),e.jsxs("div",{className:"max-w-2xl mx-auto p-4",children:[e.jsx("div",{className:"mb-8 pt-24 flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(t,{className:"h-10 w-10 rounded-full"}),e.jsx(t,{className:"h-8 w-32"})]})}),e.jsxs("div",{className:"glass-strong rounded-3xl p-6 mb-6 shadow-lg",children:[e.jsxs("div",{className:"flex items-start gap-4 mb-4",children:[e.jsx(t,{className:"w-20 h-20 rounded-full"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx(t,{className:"h-6 w-32"}),e.jsx(t,{className:"h-4 w-24"})]})]}),e.jsx(t,{className:"h-10 w-full mb-4 rounded-full"}),e.jsx(t,{className:"h-4 w-full mb-2"}),e.jsx(t,{className:"h-4 w-3/4 mb-4"}),e.jsxs("div",{className:"flex gap-6",children:[e.jsx(t,{className:"h-4 w-16"}),e.jsx(t,{className:"h-4 w-16"}),e.jsx(t,{className:"h-4 w-16"})]})]}),e.jsx("div",{className:"space-y-4",children:[1,2].map(s=>e.jsx("div",{className:"glass rounded-3xl p-6 shadow-md",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{className:"h-4 w-full"}),e.jsx(t,{className:"h-4 w-2/3"})]})},s))})]}),e.jsx(y,{})]})};export{de as default};
