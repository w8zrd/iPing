import{d as E,u as $,c as A,r as l,s as o,j as e}from"./index-G4AyO64r.js";import{N as v,M as L}from"./Navigation-C9Q6-BAp.js";import{H as y,S as D}from"./Header-DdyTimhQ.js";import{B as p}from"./Button-DzlWeRO-.js";import{A as T,a as H}from"./Avatar-CbyZJF5s.js";import{u as Y}from"./use-toast-BZ8SEqu7.js";import{P as b}from"./textParser-Cp_FlC1u.js";import{i as z,u as B,f as I}from"./user-CtncF70c.js";import{A as O}from"./arrow-left-BT0WQcYk.js";import{C as J}from"./check-DO0X9b6F.js";import{c as g}from"./createLucideIcon-9Q53b8yI.js";import{U as R}from"./user-plus-CI-zUUuH.js";import"./x-DYwVNTyk.js";import"./utils-Dtjc6EhN.js";const G=g("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);const K=g("MapPin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);const Q=g("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]),de=()=>{const{username:m}=E(),x=$(),{user:r}=A(),[a,w]=l.useState(null),[f,C]=l.useState([]),[k,u]=l.useState(0),[F,P]=l.useState(0),[n,h]=l.useState(!1),{toast:c}=Y();l.useEffect(()=>{window.scrollTo(0,0),m?_(m):r&&U()},[m,r]),l.useEffect(()=>{r&&a&&r.id!==a.id&&M(a.id)},[a,r]);const _=async s=>{const{data:t,error:i}=await o.from("profiles").select("*").eq("username",s).single();!i&&t&&(w(t),j(t.id),N(t.id))},U=async()=>{if(!r)return;const{data:s,error:t}=await o.from("profiles").select("*").eq("id",r.id).single();!t&&s&&(w(s),j(s.id),N(s.id))},j=async s=>{const{data:t,error:i}=await o.from("pings").select("*").eq("user_id",s).order("created_at",{ascending:!1});!i&&t&&C(t)},N=async s=>{const{count:t}=await o.from("follows").select("*",{count:"exact",head:!0}).eq("followed_id",s),{count:i}=await o.from("follows").select("*",{count:"exact",head:!0}).eq("follower_id",s);u(t||0),P(i||0)},M=async s=>{try{const t=await z(s);h(t)}catch(t){console.error("Error fetching following status:",t),c({title:"Error",description:"Could not fetch following status.",variant:"destructive"})}},S=async()=>{if(!(!r||!a))try{n?(await B(a.id),h(!1),u(s=>s-1),c({title:"Unfollowed!",description:`You are no longer following ${a.display_name}`})):(await I(a.id),h(!0),u(s=>s+1),c({title:"Followed!",description:`You are now following ${a.display_name}`,variant:"success"}))}catch(s){console.error("Follow/Unfollow error:",s),c({title:"Error",description:`Could not ${n?"unfollow":"follow"} ${a.display_name}.`,variant:"destructive"})}},q=async()=>{if(!r||!a)return;const{data:s,error:t}=await o.rpc("create_direct_chat",{other_user:a.id});!t&&s&&x(`/chats/${s}`)},d=r?.id===a?.id;return a?e.jsxs("div",{className:"min-h-screen pb-32",children:[e.jsx(y,{}),e.jsxs("div",{className:"max-w-2xl mx-auto p-4",children:[e.jsxs("div",{className:"mb-8 pt-24 animate-fade-in flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[!d&&e.jsx(p,{variant:"ghost",size:"icon",onClick:()=>x(-1),className:"rounded-full",children:e.jsx(O,{className:"h-5 w-5"})}),e.jsx("h1",{className:"text-3xl font-bold",children:"Profile"})]}),d&&e.jsx("button",{onClick:()=>x("/settings"),className:"p-2 rounded-full transition-colors text-muted-foreground hover:text-foreground active:text-primary",children:e.jsx(D,{className:"h-6 w-6"})})]}),e.jsxs("div",{className:"glass-strong rounded-3xl p-6 mb-6 shadow-lg animate-scale-in",children:[e.jsxs("div",{className:"flex items-start gap-4 mb-4",children:[e.jsx(T,{className:"w-20 h-20 ring-4 ring-primary/20 shadow-lg",children:e.jsx(H,{className:"bg-gradient-to-br from-primary via-primary/80 to-primary/50 text-white text-2xl font-bold",children:a.display_name[0]?.toUpperCase()||"U"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-1",children:[e.jsx("h2",{className:"text-xl font-bold",children:a.display_name}),a.verified&&e.jsx("div",{className:"flex items-center justify-center w-5 h-5 bg-primary rounded-full",children:e.jsx(J,{className:"h-3.5 w-3.5 text-white stroke-[3]"})})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["@",a.username]})]})]}),!d&&e.jsxs("div",{className:"flex gap-2 mb-4",children:[e.jsx(p,{onClick:S,variant:n?"outline":"default",className:"flex-1 rounded-full hover:scale-105 transition-apple",children:n?e.jsxs(e.Fragment,{children:[e.jsx(Q,{className:"h-4 w-4 mr-2"}),"Following"]}):e.jsxs(e.Fragment,{children:[e.jsx(R,{className:"h-4 w-4 mr-2"}),"Follow"]})}),e.jsxs(p,{onClick:q,variant:"outline",className:"flex-1 rounded-full hover:scale-105 transition-apple",children:[e.jsx(L,{className:"h-4 w-4 mr-2"}),"Message"]})]}),a.bio&&e.jsx("p",{className:"text-sm text-foreground/90 mb-4",children:e.jsx(b,{text:a.bio})}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground mb-4",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(G,{className:"h-4 w-4"}),e.jsxs("span",{children:["Joined ",new Date(a.created_at).toLocaleDateString("en-US",{month:"long",year:"numeric"})]})]}),a.location&&e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(K,{className:"h-4 w-4"}),e.jsx("span",{children:a.location})]})]}),e.jsxs("div",{className:"flex gap-6 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-bold text-foreground",children:f.length}),e.jsx("span",{className:"text-muted-foreground ml-1",children:"Pings"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-bold text-foreground",children:F}),e.jsx("span",{className:"text-muted-foreground ml-1",children:"Following"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-bold text-foreground",children:k}),e.jsx("span",{className:"text-muted-foreground ml-1",children:"Followers"})]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-xl font-semibold mb-4",children:d?"Your Pings":`${a.display_name}'s Pings`}),e.jsx("div",{className:"space-y-4",children:f.length===0?e.jsx("div",{className:"glass rounded-3xl p-8 text-center",children:e.jsx("p",{className:"text-muted-foreground",children:"No pings yet"})}):f.map((s,t)=>e.jsxs("div",{className:"glass rounded-3xl p-6 shadow-md animate-fade-in",style:{animationDelay:`${t*.05}s`},children:[e.jsx("p",{className:"text-foreground/90 mb-2",children:e.jsx(b,{text:s.content})}),s.image_url&&e.jsx("img",{src:s.image_url,alt:"Post",className:"rounded-2xl w-full mb-2 max-h-96 object-cover"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:new Date(s.created_at).toLocaleString()})]},s.id))})]})]}),e.jsx(v,{})]}):e.jsxs("div",{className:"min-h-screen pb-32",children:[e.jsx(y,{}),e.jsx("div",{className:"max-w-2xl mx-auto p-4 pt-24",children:e.jsx("p",{className:"text-muted-foreground",children:"Loading profile..."})}),e.jsx(v,{})]})};export{de as default};
