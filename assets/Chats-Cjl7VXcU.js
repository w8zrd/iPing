import{u,f as h,c as g,r as d,s as o,j as e}from"./index-DI89oLvi.js";import{N as _}from"./Navigation-CCuSAfZq.js";import{H as j}from"./Header-D2yrwniz.js";import{A as N,a as v}from"./Avatar-UWX7lTYm.js";import{C as b}from"./check-DN1bmkHn.js";import"./createLucideIcon-CJ3bZHtC.js";import"./x-CHZwQEb0.js";import"./utils-BNf5BS2b.js";const S=()=>{const m=u();h();const{user:a}=g(),[l,c]=d.useState([]);d.useEffect(()=>{a&&p()},[a]);const p=async()=>{if(!a)return;const{data:s,error:r}=await o.from("chat_participants").select(`
        chat_id,
        chats!inner(id)
      `).eq("user_id",a.id);if(r||!s)return;const i=s.map(t=>t.chat_id),f=await Promise.all(i.map(async t=>{const{data:n}=await o.from("chat_participants").select("user_id, profiles!chat_participants_user_id_fkey(id, username, display_name, verified)").eq("chat_id",t).neq("user_id",a.id).single(),{data:x}=await o.from("messages").select("content, created_at").eq("chat_id",t).order("created_at",{ascending:!1}).limit(1).single();return n!=null&&n.profiles?{id:t,other_user:n.profiles,last_message:x||void 0}:null}));c(f.filter(Boolean))};return e.jsxs("div",{className:"min-h-screen pb-32",children:[e.jsx(j,{}),e.jsxs("div",{className:"max-w-2xl mx-auto p-4",children:[e.jsx("div",{className:"mb-8 pt-24 animate-fade-in",children:e.jsx("h1",{className:"text-3xl font-bold",children:"Messages"})}),e.jsx("div",{className:"glass-strong rounded-3xl shadow-md overflow-hidden",children:l.length===0?e.jsx("div",{className:"p-8 text-center text-muted-foreground",children:"No messages yet. Start a conversation from someone's profile!"}):l.map((s,r)=>{var i;return e.jsx("button",{onClick:()=>m(`/chats/${s.id}`),className:`w-full p-4 animate-fade-in hover:bg-primary/5 transition-apple text-left ${r!==l.length-1?"border-b border-border/30":""}`,style:{animationDelay:`${r*.05}s`},children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(N,{className:"w-12 h-12",children:e.jsx(v,{className:"bg-gradient-to-br from-primary via-primary/80 to-primary/50 text-white font-bold",children:(i=s.other_user.display_name)==null?void 0:i.toUpperCase()})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"font-semibold",children:s.other_user.display_name}),s.other_user.verified&&e.jsx("div",{className:"flex items-center justify-center w-4 h-4 bg-primary rounded-full",children:e.jsx(b,{className:"h-3 w-3 text-white stroke-"})})]}),s.last_message&&e.jsx("span",{className:"text-xs text-muted-foreground whitespace-nowrap",children:new Date(s.last_message.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["@",s.other_user.username]}),s.last_message&&e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:s.last_message.content})]})]})},s.id)})})]}),e.jsx(_,{})]})};export{S as default};
