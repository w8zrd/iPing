import{d as C,u as L,c as S,l as r,r as p,j as e,L as D,s as m}from"./index-Wo41H5bh.js";import{N as q}from"./Navigation-DuyA-6As.js";import{H as I,S as U}from"./Header-CWneZju0.js";import $ from"./NotFound-iqnx5CWd.js";import{P as _}from"./textParser-Otv_Pc-Z.js";import{A}from"./arrow-left-CX4fna4Q.js";import{C as k}from"./x-BqAOQNjw.js";import{U as T}from"./user-plus-B6vegHe3.js";import{c as F}from"./createLucideIcon-foOATjnS.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O=F("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=F("MapPin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]),R={id:"0",username:"error",display_name:"Error Loading User",bio:"Profile data could not be fetched.",verified:!1,location:null,created_at:new Date().toISOString(),posts:[]},X=()=>{var j;const{username:f}=C(),d=L(),{user:s,loading:x}=S();r.debug("Profile component mounted",{urlUsername:f});const[a,c]=p.useState(null),[u,n]=p.useState(!0),g=(s==null?void 0:s.user_metadata.username)===f;if(p.useEffect(()=>{var b;if(r.debug("Profile useEffect triggered."),x)return;const t=f||((b=s==null?void 0:s.user_metadata)==null?void 0:b.username);r.debug("Profile.tsx: targetUsername derived",{targetUsername:t});const l=async h=>{n(!0),r.debug("Profile.tsx: Attempting to fetch profile",{targetUser:h}),r.debug("Profile.tsx: Fetching profile data",{targetUser:h});const{data:i,error:w}=await m.from("profiles").select("id, username, display_name, bio, verified, location, created_at").eq("username",h).single();if(w){r.error("Profile.tsx: Error fetching profile",w,{userMessage:"Failed to load profile."}),c(null),n(!1);return}if(!i){r.warn("Profile.tsx: No profile data found",{targetUser:h},{userMessage:"Profile not found."}),c(null),n(!1);return}r.debug("Profile.tsx: Successfully fetched profileData",{profileData:i}),r.debug("Profile.tsx: Fetching posts for user ID",{userId:i.id});const{data:N,error:v}=await m.from("pings").select("id, content, created_at").eq("user_id",i.id).order("created_at",{ascending:!1});v&&r.error("Profile.tsx: Error fetching posts",v,{userMessage:"Failed to load posts."}),r.debug("Profile.tsx: Posts fetched",{postsData:N});let y=!1;if(s&&s.id!==i.id){r.debug("Profile.tsx: Checking follow status",{followerId:s.id,followingId:i.id});const{count:M,error:P}=await m.from("follows").select("*",{count:"exact"}).eq("follower_id",s.id).eq("following_id",i.id);P?r.error("Profile.tsx: Error checking follow status",P):y=M>0}c({...i,posts:N||[],is_following:y}),n(!1),r.debug("Profile.tsx: setUserProfile completed.")};t?l(t):s&&s.user_metadata.username?l(s.user_metadata.username):(c(null),n(!1))},[f,x,s,d]),u||x)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx(D,{})});const o=a||R;if(!a&&!u&&!x)return e.jsx($,{});const E=async()=>{if(!s){d("/auth");return}if(s.id!==o.id){if(n(!0),a!=null&&a.is_following){const{error:t}=await m.from("follows").delete().eq("follower_id",s.id).eq("following_id",o.id);t?r.error("Profile.tsx: Error unfollowing",t,{userMessage:`Failed to unfollow: ${t.message}`,showToast:!0}):c(l=>l?{...l,is_following:!1}:null)}else{const{error:t}=await m.from("follows").insert([{follower_id:s.id,following_id:o.id}]);t?r.error("Profile.tsx: Error following",t,{userMessage:`Failed to follow: ${t.message}`,showToast:!0}):c(l=>l?{...l,is_following:!0}:null)}n(!1)}};return e.jsxs("div",{className:"min-h-screen pb-32",children:[e.jsx(I,{}),e.jsxs("div",{className:"max-w-2xl mx-auto p-4",children:[e.jsxs("div",{className:"mb-8 pt-24 animate-fade-in flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[!g&&e.jsx("button",{onClick:()=>d(-1),className:"p-2 rounded-full transition-colors text-muted-foreground hover:bg-background/80",children:e.jsx(A,{className:"h-5 w-5"})}),e.jsx("h1",{className:"text-3xl font-bold",children:"Profile"})]}),g&&e.jsx("button",{onClick:()=>d("/settings"),className:"p-2 rounded-full transition-colors text-muted-foreground hover:text-foreground active:text-primary",children:e.jsx(U,{className:"h-6 w-6"})})]}),e.jsxs("div",{className:"glass-strong rounded-3xl p-6 mb-6 shadow-lg animate-scale-in",children:[e.jsxs("div",{className:"flex items-start gap-4 mb-4",children:[e.jsx("div",{className:"relative",children:e.jsx("div",{className:"w-20 h-20 rounded-full bg-gradient-to-br from-primary via-primary/80 to-primary/50 text-white text-2xl font-bold flex items-center justify-center ring-4 ring-primary/20 shadow-lg",children:((j=o.display_name[0])==null?void 0:j.toUpperCase())||"U"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-1",children:[e.jsx("h2",{className:"text-xl font-bold",children:o.display_name}),o.verified&&e.jsx("div",{className:"flex items-center justify-center w-5 h-5 bg-primary rounded-full",children:e.jsx(k,{className:"h-3.5 w-3.5 text-white stroke-[3]"})})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["@",o.username]})]})]}),!g&&e.jsxs("div",{className:"flex gap-2 mb-4",children:[e.jsx("button",{onClick:E,disabled:u,className:`flex-1 rounded-full hover:scale-105 transition-apple h-10 px-4 py-2 text-sm font-medium ${a!=null&&a.is_following?"border border-border/50 bg-background/50 hover:bg-background/80":"bg-primary text-primary-foreground hover:bg-primary/90"} disabled:opacity-50 disabled:cursor-not-allowed items-center justify-center`,children:u?"...":a!=null&&a.is_following?e.jsxs(e.Fragment,{children:[e.jsx(k,{className:"h-4 w-4 mr-2"})," Following"]}):e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"h-4 w-4 mr-2"})," Follow"]})}),e.jsx("button",{onClick:()=>{d(s?`/chats/${o.username}`:"/auth")},className:"flex-1 rounded-full hover:scale-105 transition-apple h-10 px-4 py-2 text-sm font-medium border border-border/50 bg-background/50 hover:bg-background/80",children:"Message"})]}),e.jsx("p",{className:"text-sm text-foreground/90 mb-4",children:e.jsx(_,{text:o.bio||"No bio provided."})}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground mb-4",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(O,{className:"h-4 w-4"}),e.jsxs("span",{children:["Joined ",new Date(o.created_at).toLocaleDateString("en-US",{year:"numeric",month:"long"})]})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(H,{className:"h-4 w-4"}),e.jsx("span",{children:o.location||"Unknown"})]})]}),e.jsxs("div",{className:"flex gap-6 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-bold text-foreground",children:o.posts.length}),e.jsx("span",{className:"text-muted-foreground ml-1",children:"Posts"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-bold text-foreground",children:"0"}),e.jsx("span",{className:"text-muted-foreground ml-1",children:"Following"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-bold text-foreground",children:"0"}),e.jsx("span",{className:"text-muted-foreground ml-1",children:"Followers"})]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-xl font-semibold mb-4",children:g?"Your Posts":`${o.display_name}'s Posts`}),e.jsx("div",{className:"space-y-4",children:o.posts.map((t,l)=>e.jsxs("div",{className:"glass rounded-3xl p-6 shadow-md animate-fade-in",style:{animationDelay:`${l*.05}s`},children:[e.jsx("p",{className:"text-foreground/90 mb-2",children:e.jsx(_,{text:t.content})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:new Date(t.created_at).toLocaleString()})]},t.id))})]})]}),e.jsx(q,{})]})};export{X as default};
