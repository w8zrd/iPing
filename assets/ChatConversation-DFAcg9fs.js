import{c as E,x as M,o as T,r as i,t as z,F as R,j as e,X as F,w as h}from"./index-C_m9Ze8h.js";import{A as P,a as $}from"./avatar-k3NOjHKl.js";import{B as u}from"./button-TZBCDRHR.js";import{T as q}from"./textarea-BIMA0sH2.js";import{P as B}from"./textParser-D7RhUb-H.js";import{A as K}from"./arrow-left-yFWTmoKb.js";import{C as I}from"./check-Bf2168-U.js";import{I as O,S as V}from"./send-DNMp5uzN.js";import"./index-CIx3cqeI.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=E("CheckCheck",[["path",{d:"M18 6 7 17l-5-5",key:"116fxf"}],["path",{d:"m22 10-7.5 7.5L13 16",key:"ke71qq"}]]),ae=()=>{var y,S;const{chatId:t}=M(),D=T(),[c,p]=i.useState(""),[f,g]=i.useState([]),[o,m]=i.useState(null),[r,A]=i.useState(null),{user:a}=z(),{markChatAsRead:x,fetchChatDetails:j,fetchChatMessages:b,sendMessage:L,subscribeToChatMessages:N}=R(),v=i.useRef(null),[G,C]=i.useState(!0);(y=r==null?void 0:r.chat_participants)==null||y.find(s=>s.user_id!==(a==null?void 0:a.id));const w=i.useCallback(()=>{if(!t||!a)return()=>{};C(!0);const s=j(t,l=>{A(l)}),n=b(t,l=>{g(l),x(t),C(!1)});return()=>{s(),n()}},[t,a,j,b,x]);i.useEffect(()=>{const s=w(),n=N(t,l=>{g(d=>[...d,l]),x(t)});return()=>{s(),n()}},[t,a,N,w]),i.useEffect(()=>{var s;(s=v.current)==null||s.scrollIntoView({behavior:"smooth"})},[f]);const _=s=>{var l;const n=(l=s.target.files)==null?void 0:l[0];if(n){const d=new FileReader;d.onloadend=()=>{m(d.result),h.debug("Image loaded for preview")},d.readAsDataURL(n)}},k=async()=>{if((c.trim()||o)&&t){h.debug("Sending message",{chatId:t,hasContent:!!c,hasImage:!!o});try{await L(t,c),p(""),m(null)}catch(s){h.error("Failed to send message",s)}}};return e.jsxs("div",{className:"min-h-screen flex flex-col",children:[e.jsx("header",{className:"fixed top-0 left-0 right-0 z-50 glass-strong border-b",children:e.jsxs("div",{className:"flex items-center gap-3 p-4",children:[e.jsx(u,{variant:"ghost",size:"icon",onClick:()=>D("/chats"),className:"rounded-full",children:e.jsx(K,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[e.jsxs("div",{className:"relative",children:[e.jsx(P,{className:"w-10 h-10",children:e.jsx($,{className:"bg-gradient-to-br from-primary via-primary/80 to-primary/50 text-white font-bold",children:(S=r.user.displayName[0])==null?void 0:S.toUpperCase()})}),(r.user.username==="alex"||r.user.username==="mike")&&e.jsx("div",{className:"absolute bottom-0 right-0 w-3 h-3 bg-green-500 rounded-full border-2 border-background"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"font-semibold",children:r.user.displayName}),r.user.verified&&e.jsx("div",{className:"flex items-center justify-center w-4 h-4 bg-primary rounded-full",children:e.jsx(I,{className:"h-3 w-3 text-white stroke-[3]"})})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsxs("span",{children:["@",r.user.username]}),e.jsx("span",{children:"â€¢"}),r.user.username==="alex"||r.user.username==="mike"?e.jsx("span",{className:"text-green-500 font-medium",children:"Online"}):e.jsx("span",{children:"Last seen 2h ago"})]})]})]})]})}),e.jsx("main",{className:"flex-1 pt-20 pb-32 px-4 max-w-2xl mx-auto w-full",children:e.jsxs("div",{className:"space-y-4",children:[f.map(s=>e.jsx("div",{className:`flex ${s.sender_id===(a==null?void 0:a.id)?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-[75%] rounded-2xl px-4 py-2 ${s.sender_id===(a==null?void 0:a.id)?"bg-primary text-primary-foreground":"glass-strong"}`,children:[s.content&&e.jsx("p",{className:"text-sm",children:e.jsx(B,{text:s.content})}),e.jsxs("div",{className:"flex items-center gap-1.5 mt-1",children:[e.jsx("p",{className:"text-xs opacity-70",children:new Date(s.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),s.sender_id===(a==null?void 0:a.id)&&e.jsx("span",{className:`${s.is_read?"text-green-400":"text-primary-foreground"}`,children:s.is_read?e.jsx(X,{className:"h-3 w-3"}):e.jsx(I,{className:"h-3 w-3"})})]})]})},s.id)),e.jsx("div",{ref:v})]})}),e.jsx("footer",{className:"fixed bottom-0 left-0 right-0 z-50 pb-safe",children:e.jsxs("div",{className:"glass-strong border-t mx-4 mb-4 rounded-3xl p-4",children:[o&&e.jsxs("div",{className:"relative mb-3",children:[e.jsx("img",{src:o,alt:"Upload preview",className:"rounded-2xl max-h-40 w-auto"}),e.jsx("button",{onClick:()=>m(null),className:"absolute top-2 right-2 bg-background/80 backdrop-blur-sm rounded-full p-1.5 hover:bg-background transition-apple",children:e.jsx(F,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsxs("label",{className:"shrink-0",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:_,className:"hidden"}),e.jsx(u,{type:"button",variant:"outline",size:"icon",className:"rounded-full h-11 w-11",onClick:s=>{var n;s.preventDefault(),(n=s.currentTarget.previousElementSibling)==null||n.click()},children:e.jsx(O,{className:"h-5 w-5"})})]}),e.jsx(q,{value:c,onChange:s=>p(s.target.value),placeholder:"Type a message...",className:"flex-1 min-h-[44px] max-h-32 resize-none rounded-2xl",onKeyDown:s=>{s.key==="Enter"&&!s.shiftKey&&(s.preventDefault(),k())}}),e.jsx(u,{onClick:k,size:"icon",className:"rounded-full h-11 w-11 shrink-0",disabled:!c.trim()&&!o,children:e.jsx(V,{className:"h-5 w-5"})})]})]})})]})};export{ae as default};
