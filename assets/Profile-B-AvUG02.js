import{c as M,x as S,o as D,t as A,w as r,r as w,s as U,j as e,L as q,v as f}from"./index-BviwBOFj.js";import{N as I}from"./Navigation-CBbH8e9z.js";import{H as $,S as T}from"./Header-x73boukx.js";import{B as j}from"./button-B8dY9mXZ.js";import{A as Y,a as O}from"./avatar-f286yw92.js";import z from"./NotFound-BhQeyo1Y.js";import{P as k}from"./textParser-DQjuO3no.js";import{A as B}from"./arrow-left-CycPIZ6Y.js";import{C as E}from"./check-W_1vnMSX.js";import{U as H}from"./user-plus-SWYjuldY.js";import"./input-Cj_0U1ju.js";import"./index-CPHWhxBT.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R=M("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=M("MapPin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]),G={id:"0",username:"error",display_name:"Error Loading User",bio:"Profile data could not be fetched.",verified:!1,location:null,created_at:new Date().toISOString(),posts:[]},le=()=>{var N;const{username:m}=S(),d=D(),{user:s,loading:x}=A();r.debug("Profile component mounted",{urlUsername:m});const[o,c]=w.useState(null),[u,n]=w.useState(!0),{toast:p}=U(),g=(s==null?void 0:s.user_metadata.username)===m;if(w.useEffect(()=>{var v;if(r.debug("Profile useEffect triggered."),x)return;const t=m||((v=s==null?void 0:s.user_metadata)==null?void 0:v.username);r.debug("Profile.tsx: targetUsername derived",{targetUsername:t});const l=async h=>{n(!0),r.debug("Profile.tsx: Attempting to fetch profile",{targetUser:h}),r.debug("Profile.tsx: Fetching profile data",{targetUser:h});const{data:i,error:b}=await f.from("profiles").select("id, username, display_name, bio, verified, location, created_at").eq("username",h).single();if(b){r.error("Profile.tsx: Error fetching profile",b,{userMessage:"Failed to load profile."}),c(null),n(!1);return}if(!i){r.warn("Profile.tsx: No profile data found",{targetUser:h},{userMessage:"Profile not found."}),c(null),n(!1);return}r.debug("Profile.tsx: Successfully fetched profileData",{profileData:i}),r.debug("Profile.tsx: Fetching posts for user ID",{userId:i.id});const{data:y,error:_}=await f.from("pings").select("id, content, created_at").eq("user_id",i.id).order("created_at",{ascending:!1});_&&r.error("Profile.tsx: Error fetching posts",_,{userMessage:"Failed to load posts."}),r.debug("Profile.tsx: Posts fetched",{postsData:y});let P=!1;if(s&&s.id!==i.id){r.debug("Profile.tsx: Checking follow status",{followerId:s.id,followingId:i.id});const{count:L,error:F}=await f.from("follows").select("*",{count:"exact"}).eq("follower_id",s.id).eq("following_id",i.id);F?r.error("Profile.tsx: Error checking follow status",F):P=L>0}c({...i,posts:y||[],is_following:P}),n(!1),r.debug("Profile.tsx: setUserProfile completed.")};t?l(t):s&&s.user_metadata.username?l(s.user_metadata.username):(c(null),n(!1))},[m,x,s,d]),u||x)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx(q,{})});const a=o||G;if(!o&&!u&&!x)return e.jsx(z,{});const C=async()=>{if(!s){d("/auth");return}if(s.id===a.id){p({title:"Error",description:"You cannot follow yourself.",variant:"destructive"});return}if(n(!0),o!=null&&o.is_following){const{error:t}=await f.from("follows").delete().eq("follower_id",s.id).eq("following_id",a.id);t?r.error("Profile.tsx: Error unfollowing",t,{userMessage:`Failed to unfollow: ${t.message}`,showToast:!0}):(c(l=>l?{...l,is_following:!1}:null),p({title:"Unfollowed!",description:`You are no longer following ${a.display_name}.`}))}else{const{error:t}=await f.from("follows").insert([{follower_id:s.id,following_id:a.id}]);t?r.error("Profile.tsx: Error following",t,{userMessage:`Failed to follow: ${t.message}`,showToast:!0}):(c(l=>l?{...l,is_following:!0}:null),p({title:"Followed!",description:`You are now following ${a.display_name}.`}))}n(!1)};return e.jsxs("div",{className:"min-h-screen pb-32",children:[e.jsx($,{}),e.jsxs("div",{className:"max-w-2xl mx-auto p-4",children:[e.jsxs("div",{className:"mb-8 pt-24 animate-fade-in flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[!g&&e.jsx(j,{variant:"ghost",size:"icon",onClick:()=>d(-1),className:"rounded-full",children:e.jsx(B,{className:"h-5 w-5"})}),e.jsx("h1",{className:"text-3xl font-bold",children:"Profile"})]}),g&&e.jsx("button",{onClick:()=>d("/settings"),className:"p-2 rounded-full transition-colors text-muted-foreground hover:text-foreground active:text-primary",children:e.jsx(T,{className:"h-6 w-6"})})]}),e.jsxs("div",{className:"glass-strong rounded-3xl p-6 mb-6 shadow-lg animate-scale-in",children:[e.jsxs("div",{className:"flex items-start gap-4 mb-4",children:[e.jsx("div",{className:"relative",children:e.jsx(Y,{className:"w-20 h-20 ring-4 ring-primary/20 shadow-lg",children:e.jsx(O,{className:"bg-gradient-to-br from-primary via-primary/80 to-primary/50 text-white text-2xl font-bold",children:((N=a.display_name[0])==null?void 0:N.toUpperCase())||"U"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-1",children:[e.jsx("h2",{className:"text-xl font-bold",children:a.display_name}),a.verified&&e.jsx("div",{className:"flex items-center justify-center w-5 h-5 bg-primary rounded-full",children:e.jsx(E,{className:"h-3.5 w-3.5 text-white stroke-[3]"})})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["@",a.username]})]})]}),!g&&e.jsxs("div",{className:"flex gap-2 mb-4",children:[e.jsx(j,{onClick:C,disabled:u,variant:o!=null&&o.is_following?"outline":"default",className:"flex-1 rounded-full hover:scale-105 transition-apple",children:u?"...":o!=null&&o.is_following?e.jsxs(e.Fragment,{children:[e.jsx(E,{className:"h-4 w-4 mr-2"})," Following"]}):e.jsxs(e.Fragment,{children:[e.jsx(H,{className:"h-4 w-4 mr-2"})," Follow"]})}),e.jsx(j,{onClick:()=>{d(s?`/chats/${a.username}`:"/auth")},variant:"outline",className:"flex-1 rounded-full hover:scale-105 transition-apple",children:"Message"})]}),e.jsx("p",{className:"text-sm text-foreground/90 mb-4",children:e.jsx(k,{text:a.bio||"No bio provided."})}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground mb-4",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(R,{className:"h-4 w-4"}),e.jsxs("span",{children:["Joined ",new Date(a.created_at).toLocaleDateString("en-US",{year:"numeric",month:"long"})]})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(J,{className:"h-4 w-4"}),e.jsx("span",{children:a.location||"Unknown"})]})]}),e.jsxs("div",{className:"flex gap-6 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-bold text-foreground",children:a.posts.length}),e.jsx("span",{className:"text-muted-foreground ml-1",children:"Posts"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-bold text-foreground",children:"0"}),e.jsx("span",{className:"text-muted-foreground ml-1",children:"Following"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-bold text-foreground",children:"0"}),e.jsx("span",{className:"text-muted-foreground ml-1",children:"Followers"})]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-xl font-semibold mb-4",children:g?"Your Posts":`${a.display_name}'s Posts`}),e.jsx("div",{className:"space-y-4",children:a.posts.map((t,l)=>e.jsxs("div",{className:"glass rounded-3xl p-6 shadow-md animate-fade-in",style:{animationDelay:`${l*.05}s`},children:[e.jsx("p",{className:"text-foreground/90 mb-2",children:e.jsx(k,{text:t.content})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:new Date(t.created_at).toLocaleString()})]},t.id))})]})]}),e.jsx(I,{})]})};export{le as default};
