import{d as $,u as A,c as L,r as l,s as o,j as e}from"./index-DI89oLvi.js";import{N as y,M as D}from"./Navigation-CCuSAfZq.js";import{H as b,S as T}from"./Header-D2yrwniz.js";import{B as p}from"./Button-Cw2Gr0ER.js";import{A as H,a as Y}from"./Avatar-UWX7lTYm.js";import{u as z}from"./use-toast-DaUEFXXE.js";import{P as C}from"./textParser-Bya1rKIJ.js";import{i as B,u as I,f as O}from"./user-TwC2sY1s.js";import{A as J}from"./arrow-left-BobK73xn.js";import{C as R}from"./check-DN1bmkHn.js";import{c as g}from"./createLucideIcon-CJ3bZHtC.js";import{U as G}from"./user-plus-pFQmeAU3.js";import"./x-CHZwQEb0.js";import"./utils-BNf5BS2b.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=g("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=g("MapPin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V=g("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]),me=()=>{var v;const{username:m}=$(),x=A(),{user:r}=L(),[a,w]=l.useState(null),[f,k]=l.useState([]),[F,h]=l.useState(0),[P,_]=l.useState(0),[i,u]=l.useState(!1),{toast:c}=z();l.useEffect(()=>{window.scrollTo(0,0),m?U(m):r&&M()},[m,r]),l.useEffect(()=>{r&&a&&r.id!==a.id&&S(a.id)},[a,r]);const U=async s=>{const{data:t,error:n}=await o.from("profiles").select("*").eq("username",s).single();!n&&t&&(w(t),j(t.id),N(t.id))},M=async()=>{if(!r)return;const{data:s,error:t}=await o.from("profiles").select("*").eq("id",r.id).single();!t&&s&&(w(s),j(s.id),N(s.id))},j=async s=>{const{data:t,error:n}=await o.from("pings").select("*").eq("user_id",s).order("created_at",{ascending:!1});!n&&t&&k(t)},N=async s=>{const{count:t}=await o.from("follows").select("*",{count:"exact",head:!0}).eq("followed_id",s),{count:n}=await o.from("follows").select("*",{count:"exact",head:!0}).eq("follower_id",s);h(t||0),_(n||0)},S=async s=>{try{const t=await B(s);u(t)}catch(t){console.error("Error fetching following status:",t),c({title:"Error",description:"Could not fetch following status.",variant:"destructive"})}},q=async()=>{if(!(!r||!a))try{i?(await I(a.id),u(!1),h(s=>s-1),c({title:"Unfollowed!",description:`You are no longer following ${a.display_name}`})):(await O(a.id),u(!0),h(s=>s+1),c({title:"Followed!",description:`You are now following ${a.display_name}`,variant:"success"}))}catch(s){console.error("Follow/Unfollow error:",s),c({title:"Error",description:`Could not ${i?"unfollow":"follow"} ${a.display_name}.`,variant:"destructive"})}},E=async()=>{if(!r||!a)return;const{data:s,error:t}=await o.rpc("create_direct_chat",{other_user:a.id});!t&&s&&x(`/chats/${s}`)},d=(r==null?void 0:r.id)===(a==null?void 0:a.id);return a?e.jsxs("div",{className:"min-h-screen pb-32",children:[e.jsx(b,{}),e.jsxs("div",{className:"max-w-2xl mx-auto p-4",children:[e.jsxs("div",{className:"mb-8 pt-24 animate-fade-in flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[!d&&e.jsx(p,{variant:"ghost",size:"icon",onClick:()=>x(-1),className:"rounded-full",children:e.jsx(J,{className:"h-5 w-5"})}),e.jsx("h1",{className:"text-3xl font-bold",children:"Profile"})]}),d&&e.jsx("button",{onClick:()=>x("/settings"),className:"p-2 rounded-full transition-colors text-muted-foreground hover:text-foreground active:text-primary",children:e.jsx(T,{className:"h-6 w-6"})})]}),e.jsxs("div",{className:"glass-strong rounded-3xl p-6 mb-6 shadow-lg animate-scale-in",children:[e.jsxs("div",{className:"flex items-start gap-4 mb-4",children:[e.jsx(H,{className:"w-20 h-20 ring-4 ring-primary/20 shadow-lg",children:e.jsx(Y,{className:"bg-gradient-to-br from-primary via-primary/80 to-primary/50 text-white text-2xl font-bold",children:((v=a.display_name[0])==null?void 0:v.toUpperCase())||"U"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-1",children:[e.jsx("h2",{className:"text-xl font-bold",children:a.display_name}),a.verified&&e.jsx("div",{className:"flex items-center justify-center w-5 h-5 bg-primary rounded-full",children:e.jsx(R,{className:"h-3.5 w-3.5 text-white stroke-[3]"})})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["@",a.username]})]})]}),!d&&e.jsxs("div",{className:"flex gap-2 mb-4",children:[e.jsx(p,{onClick:q,variant:i?"outline":"default",className:"flex-1 rounded-full hover:scale-105 transition-apple",children:i?e.jsxs(e.Fragment,{children:[e.jsx(V,{className:"h-4 w-4 mr-2"}),"Following"]}):e.jsxs(e.Fragment,{children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),"Follow"]})}),e.jsxs(p,{onClick:E,variant:"outline",className:"flex-1 rounded-full hover:scale-105 transition-apple",children:[e.jsx(D,{className:"h-4 w-4 mr-2"}),"Message"]})]}),a.bio&&e.jsx("p",{className:"text-sm text-foreground/90 mb-4",children:e.jsx(C,{text:a.bio})}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground mb-4",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(K,{className:"h-4 w-4"}),e.jsxs("span",{children:["Joined ",new Date(a.created_at).toLocaleDateString("en-US",{month:"long",year:"numeric"})]})]}),a.location&&e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(Q,{className:"h-4 w-4"}),e.jsx("span",{children:a.location})]})]}),e.jsxs("div",{className:"flex gap-6 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-bold text-foreground",children:f.length}),e.jsx("span",{className:"text-muted-foreground ml-1",children:"Pings"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-bold text-foreground",children:P}),e.jsx("span",{className:"text-muted-foreground ml-1",children:"Following"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-bold text-foreground",children:F}),e.jsx("span",{className:"text-muted-foreground ml-1",children:"Followers"})]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-xl font-semibold mb-4",children:d?"Your Pings":`${a.display_name}'s Pings`}),e.jsx("div",{className:"space-y-4",children:f.length===0?e.jsx("div",{className:"glass rounded-3xl p-8 text-center",children:e.jsx("p",{className:"text-muted-foreground",children:"No pings yet"})}):f.map((s,t)=>e.jsxs("div",{className:"glass rounded-3xl p-6 shadow-md animate-fade-in",style:{animationDelay:`${t*.05}s`},children:[e.jsx("p",{className:"text-foreground/90 mb-2",children:e.jsx(C,{text:s.content})}),s.image_url&&e.jsx("img",{src:s.image_url,alt:"Post",className:"rounded-2xl w-full mb-2 max-h-96 object-cover"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:new Date(s.created_at).toLocaleString()})]},s.id))})]})]}),e.jsx(y,{})]}):e.jsxs("div",{className:"min-h-screen pb-32",children:[e.jsx(b,{}),e.jsx("div",{className:"max-w-2xl mx-auto p-4 pt-24",children:e.jsx("p",{className:"text-muted-foreground",children:"Loading profile..."})}),e.jsx(y,{})]})};export{me as default};
