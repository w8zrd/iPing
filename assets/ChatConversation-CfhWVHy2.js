import{d as E,u as I,r,f as A,c as R,s as l,j as e}from"./index-DI89oLvi.js";import{A as T,a as q}from"./Avatar-UWX7lTYm.js";import{B as h}from"./Button-Cw2Gr0ER.js";import{T as z}from"./Textarea-DIh8qrk3.js";import{P as D}from"./textParser-Bya1rKIJ.js";import{A as L}from"./arrow-left-BobK73xn.js";import{C as v}from"./check-DN1bmkHn.js";import{c as U}from"./createLucideIcon-CJ3bZHtC.js";import{X as M}from"./x-CHZwQEb0.js";import{I as $,S as P}from"./send-Dmn57hO1.js";import"./utils-BNf5BS2b.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const b=U("CheckCheck",[["path",{d:"M18 6 7 17l-5-5",key:"116fxf"}],["path",{d:"m22 10-7.5 7.5L13 16",key:"ke71qq"}]]),Y=()=>{var j;const{chatId:t}=E(),y=I(),[c,x]=r.useState(""),[f,w]=r.useState([]),[n,k]=r.useState(null),[u,o]=r.useState(null),{markChatAsRead:C}=A(),{user:a}=R(),p=r.useRef(null);r.useEffect(()=>{t&&a&&(C(t),_(),d())},[t,a]),r.useEffect(()=>{if(!t)return;const s=l.channel(`messages-${t}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"messages",filter:`chat_id=eq.${t}`},()=>{d()}).subscribe();return()=>{l.removeChannel(s)}},[t]),r.useEffect(()=>{var s;(s=p.current)==null||s.scrollIntoView({behavior:"smooth"})},[f]);const _=async()=>{if(!t||!a)return;const{data:s}=await l.from("chat_participants").select("user_id, profiles!chat_participants_user_id_fkey(id, username, display_name, verified)").eq("chat_id",t).neq("user_id",a.id).single();s!=null&&s.profiles&&k(s.profiles)},d=async()=>{if(!t)return;const{data:s,error:i}=await l.from("messages").select("*").eq("chat_id",t).order("created_at",{ascending:!0});!i&&s&&w(s)},S=s=>{var N;const i=(N=s.target.files)==null?void 0:N[0];if(i){const m=new FileReader;m.onloadend=()=>{o(m.result)},m.readAsDataURL(i)}},g=async()=>{if(!c.trim()||!t||!a)return;const{error:s}=await l.from("messages").insert({chat_id:t,user_id:a.id,content:c,status:"sent"});s||(x(""),o(null),d())};return n?e.jsxs("div",{className:"min-h-screen flex flex-col",children:[e.jsx("header",{className:"fixed top-0 left-0 right-0 z-50 glass-strong border-b",children:e.jsxs("div",{className:"flex items-center gap-3 p-4",children:[e.jsx(h,{variant:"ghost",size:"icon",onClick:()=>y("/chats"),className:"rounded-full",children:e.jsx(L,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[e.jsx(T,{className:"w-10 h-10",children:e.jsx(q,{className:"bg-gradient-to-br from-primary via-primary/80 to-primary/50 text-white font-bold",children:(j=n.display_name[0])==null?void 0:j.toUpperCase()})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"font-semibold",children:n.display_name}),n.verified&&e.jsx("div",{className:"flex items-center justify-center w-4 h-4 bg-primary rounded-full",children:e.jsx(v,{className:"h-3 w-3 text-white stroke-[3]"})})]}),e.jsx("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:e.jsxs("span",{children:["@",n.username]})})]})]})]})}),e.jsx("main",{className:"flex-1 pt-20 pb-32 px-4 max-w-2xl mx-auto w-full",children:e.jsxs("div",{className:"space-y-4",children:[f.map(s=>e.jsx("div",{className:`flex ${s.user_id===(a==null?void 0:a.id)?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-[75%] rounded-2xl px-4 py-2 ${s.user_id===(a==null?void 0:a.id)?"bg-primary text-primary-foreground":"glass-strong"}`,children:[e.jsx("p",{className:"text-sm",children:e.jsx(D,{text:s.content})}),e.jsxs("div",{className:"flex items-center gap-1.5 mt-1",children:[e.jsx("p",{className:"text-xs opacity-70",children:new Date(s.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),s.user_id===(a==null?void 0:a.id)&&s.status&&e.jsxs("span",{children:[s.status==="sent"&&e.jsx(v,{className:"h-3 w-3"}),s.status==="delivered"&&e.jsx(b,{className:"h-3 w-3"}),s.status==="seen"&&e.jsx(b,{className:"h-3 w-3 text-green-400"})]})]})]})},s.id)),e.jsx("div",{ref:p})]})}),e.jsx("footer",{className:"fixed bottom-0 left-0 right-0 z-50 pb-safe",children:e.jsxs("div",{className:"glass-strong border-t mx-4 mb-4 rounded-3xl p-4",children:[u&&e.jsxs("div",{className:"relative mb-3",children:[e.jsx("img",{src:u,alt:"Upload preview",className:"rounded-2xl max-h-40 w-auto"}),e.jsx("button",{onClick:()=>o(null),className:"absolute top-2 right-2 bg-background/80 backdrop-blur-sm rounded-full p-1.5 hover:bg-background transition-apple",children:e.jsx(M,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsxs("label",{className:"shrink-0",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:S,className:"hidden"}),e.jsx(h,{type:"button",variant:"outline",size:"icon",className:"rounded-full h-11 w-11",onClick:s=>{var i;s.preventDefault(),(i=s.currentTarget.previousElementSibling)==null||i.click()},children:e.jsx($,{className:"h-5 w-5"})})]}),e.jsx(z,{value:c,onChange:s=>x(s.target.value),placeholder:"Type a message...",className:"flex-1 min-h-[44px] max-h-32 resize-none rounded-2xl",onKeyDown:s=>{s.key==="Enter"&&!s.shiftKey&&(s.preventDefault(),g())}}),e.jsx(h,{onClick:g,size:"icon",className:"rounded-full h-11 w-11 shrink-0",disabled:!c.trim(),children:e.jsx(P,{className:"h-5 w-5"})})]})]})})]}):e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:"Loading..."})};export{Y as default};
